Vue.filter("moment",function(e,i){return moment(e).format(i)}),Vue.filter("momentToNow",function(e,i){var t=moment(),o=moment(e.replace(" ",""));return t.to(o)}),Vue.filter("toHours",function(e){e=parseInt(e);var i=Math.floor(e/60),t=e%60;return moment().hour(i).minute(t).format(window.app_wp_locale.time_format);return i+":"+t}),Vue.filter("minToHours",function(e){e=parseInt(e);var i="",t=Math.floor(e/60),o=e%60;return 0===t?e+"' ":t+"h "+(0===o?"":o+"' ")}),Vue.directive("click-outside",{bind:function(e,i,t){e.event=function(o){e==o.target||e.contains(o.target)||t.context[i.expression](o)},document.body.addEventListener("click",e.event)},unbind:function(e){document.body.removeEventListener("click",e.event)}}),Vue.mixin({data:function(){return{models:{service:{id:0,status:"publish",tagline:"",name:"",price:0,description:"",color:"#EB2026",duration_type:30,duration:30,availability:{days:{1:[[540,1020]],2:[[540,1020]],3:[[540,1020]],4:[[540,1020]],5:[[540,1020]]},specific:{},empty:[]},padding:{before:0,after:0},rolling_method:1,rolling_days:40,rolling_date_range:[],capacity:1},notification:{id:0,status:"publish",name:"",type:"email",trigger:"booking_confirmation",system:!1,subject:"",body:"",from_name:window.app_wp_locale.current_user.name,from_email:window.app_wp_locale.current_user.email,to:"{{invitee_email}}"},shortcodes:window.app_wp_models.shortcodes}}},computed:{date_format:function(){return window.app_wp_locale.date_format},currency_symbol:function(){return window.app_wp_locale.currency_symbol},currency_decimals:function(){return window.app_wp_locale.currency_decimals},currency_options:function(){return{thousandsSeparator:window.app_wp_locale.currency_thousands,decimalSeparator:window.app_wp_locale.currency_separator,symbolOnLeft:1!==window.app_wp_locale.currency_position&&3!==window.app_wp_locale.currency_position,spaceBetweenAmountAndSymbol:2===window.app_wp_locale.currency_position||4===window.app_wp_locale.currency_position}}},methods:{normalizeServicesShortcode:function(e){var i=this;return _.pick(e,_.keys(i.models.shortcodes.services))},normalizeNotification:function(e){var i=this;return _.pick(e,_.keys(i.models.notification))},normalizeService:function(e){var i=this;return _.pick(e,_.keys(i.models.service))},normalize:function(e){return JSON.parse(JSON.stringify(e))},getInitials:function(e){var i=this,t="";if(void 0===e||null===e||e.length<=1)return"";var o=e.split(" ");return o.length>1?(o=o.slice(0,2),_.each(o,function(e,i){t+=void 0!==e[0]?e[0]:""})):t=o[0].length>1?o[0].substring(0,2):o[0],t.replace(" ",""),t}}}),Vue.component("local-appointmentsshortcode-services",{props:["atts"],template:"#local-appointmentstemplate__component__shortcode-services",data:function(){var e=this;return{loading:!1,choose_service:!0,choose_day:!1,choose_time:!1,choose_details:!1,form:{service:{},day:"",time:0},options:{}}},watch:{options:{handler:function(e){this.limit=e.days_limit},deep:!0}},mounted:function(){var e=this;_.isEmpty(e.options)&&e.getShortcodeOptions("free")},methods:{getShortcodeOptions:function(e){var i=this;i.$http.get(window.app_wp_locale.rest_api_base.shortcodes.services+e,{emulateJSON:!0,headers:{"X-WP-Nonce":window.app_wp_locale.rest_nonce}}).then(function(e){console.log(e),200===e.status&&(i.options=i.normalizeServicesShortcode(e.body)),i.loading=!1},function(e){i.loading=!1})},confirmTime:function(e,i){var t=this;t.confirm_time=e,i&&(t.form.time=e,t.choose_time=!1,t.choose_details=!0)},openTime:function(e){var i=this;i.form.day=e.date,i.choose_time=!0,i.choose_day=!1},backToServices:function(){var e=this;e.choose_service=!0,e.choose_day=!1,e.form.service={}},backToDays:function(){var e=this;e.choose_service=!1,e.choose_day=!0,e.choose_time=!1,e.form.day=""},openDay:function(e){var i=this;i.choose_service=!1,i.choose_day=!0,i.form.service=e},openDetails:function(e){var i=this;i.choose_time=!1,i.choose_details=!0,i.form.time=e},normalize:function(e){return JSON.parse(JSON.stringify(e))}}}),Vue.component("local-appointmentsshortcode-services-choose-service",{props:["options","preview"],template:"#local-appointmentstemplate__component__shortcode-services-choose-service",data:function(){var e=this;return{loading:!1,services:{}}},mounted:function(){var e=this;_.isEmpty(e.services)&&e.getServices()},computed:{classes:function(){return"columns--"+this.options.columns}},methods:{getServices:function(){var e=this;e.loading=!0,e.$http.get(window.app_wp_locale.rest_api_base.services+"?per_page=100",{emulateJSON:!0,headers:{"X-WP-Nonce":window.app_wp_locale.rest_nonce}}).then(function(i){e.services=_.map(i.body,e.normalizeService),e.loading=!1,!_.isUndefined(e.services[0])&&e.preview&&e.$emit("service-selected",e.services[0])},function(i){console.log(i),e.loading=!1})},openDay:function(e){this.$emit("service-selected",e)}}}),Vue.component("local-appointmentsshortcode-services-choose-day",{props:["options","preview","service","options"],template:"#local-appointmentstemplate__component__shortcode-services-choose-day",data:function(){var e=this;return{loading:!1,filter_day:-1,filter_time_starting:0,filter_time_ending:1440,first_day:parseInt(window.app_wp_locale.first_day),today:moment().format("YYYY-MM-DD"),calendar_day:"",limit:e.options.days_limit}},mounted:function(){_.isUndefined(this.service)||this.setDefaultTimeFilters()},watch:{service:function(e){var i=this;i.setDefaultTimeFilters(),!_.isUndefined(i.days[0])&&i.preview&&i.$emit("day-selected",i.days[0])}},computed:{classes:function(){return"columns--"+this.options.columns},week:function(){for(var e=this,i=[],t=e.first_day;t<e.first_day+7;t++){var o=t<=6?t:Math.abs(t-7);e.isWorkingDay(o)&&i.push(o)}return i},services_min_time:function(){var e=this,i=1441;return _.isUndefined(e.service.availability.days)||_.each(e.service.availability.days,function(e){_.each(e,function(e){i=e[0]<i?e[0]:i})}),i},services_max_time:function(){var e=this,i=-1;return _.isUndefined(e.service.availability.days)||_.each(e.service.availability.days,function(e){_.each(e,function(e){i=e[1]<i?i:e[1]})}),i},filter_starting_times:function(){for(var e=this,i=[],t=e.services_min_time,o=e.services_max_time,n=t;n<=o;n++)n%60==0&&i.push(n);return i},filter_ending_times:function(){for(var e=this,i=[],t=e.services_min_time+e.service.duration,o=e.services_max_time,n=t;n<=o;n++)n%60==0&&i.push(n);return i},days:function(){for(var e=this,i=[],t=e.limit<e.options.days_limit?e.options.days_limit:e.limit,o=e.normalize(e.service),n=0;i.length<t&&n<=100;){var s=!0,a=e.today,r=moment(a).add(n,"days"),c=moment(a).add(n,"days").isoWeekday().toString();-1!==e.filter_day&&parseInt(e.filter_day)!==parseInt(c)&&(s=!1),s&&!_.isUndefined(o.availability.empty)&&o.availability.empty.indexOf(r.format("YYYY_MM_DD"))>=0&&(s=!1),!s||_.isUndefined(o.availability.days)||_.isUndefined(o.availability.days[c])?s=!1:_.each(o.availability.days[c],function(i){var t=i[0]<e.filter_time_starting?i[0]:e.filter_time_starting,o=i[1]>e.filter_time_ending?i[1]:e.filter_time_ending;s=!(o-t>i[1]-i[0]+e.filter_time_ending-e.filter_time_starting)}),s&&i.push({date:r.format("YYYY-MM-DD"),today:r.isSame(e.today,"day"),unavaiable:Math.random()>=.5}),n++}return _.sortBy(i,["date"])}},methods:{setDefaultTimeFilters:function(){this.filter_time_starting=this.filter_starting_times[0],this.filter_time_ending=this.filter_ending_times[this.filter_ending_times.length-1]},isWorkingDay:function(e){var i=this,t=!1;return _.each(i.service.availability.specific,function(i,o){moment(o.split("_").join("/")).isoWeekday()===e&&(t=!0)}),_.each(i.service.availability.days,function(i,o){parseInt(o)===e&&(t=!0)}),t},selectDay:function(e){this.$emit("day-selected",e)},getDayName:function(e){return window.app_wp_locale.day_names[e]},showMore:function(){this.limit+=this.options.days_limit},openTime:function(e){var i=this;i.form.day=e.date,i.choose_time=!0,i.choose_day=!1},getDayClasses:function(e){var i=this,t="";return e.unavaiable&&(t+="local-appointmentsshortcode-services__day--unavailable "),e.today&&(t+="local-appointmentsshortcode-services__day--today "),t},isSameMonth:function(e,i){var t=this;return!_.isUndefined(t.days[i-1])&&!_.isUndefined(t.days[i-1].date)&&!moment(e.date).isSame(moment(t.days[i-1].date),"month")},backToServices:function(){var e=this}}}),Vue.component("local-appointmentsshortcode-services-choose-time",{props:["options","service","preview","day"],template:"#local-appointmentstemplate__component__shortcode-services-choose-time",data:function(){var e=this;return{loading:!1,confirm_time:!1}},computed:{times:function(){var e=this,i=[],t=_.isUndefined(e.service.availability.days[moment(e.day).isoWeekday().toString()])?[]:e.service.availability.days[moment(e.day).isoWeekday().toString()];return _.each(t,function(t){for(var o=t[0];o<t[1]-e.service.duration;o++)o%e.options.time_increments==0&&i.push(o)}),i}},methods:{confirmTime:function(e,i){this.confirm_time=e,i&&this.$emit("time-selected",e)},clearConfirmation:function(e){this.confirm_time=!1},isSamePeriod:function(e,i){var t=this;return!_.isUndefined(t.times[i-1])&&(e/60>=12&&t.times[i-1]/60<12)},getTimeClasses:function(e){var i=this,t="";return!1!==i.confirm_time&&i.confirm_time!==e?t+="loc-app-sc-services__time--not-confirm":!1!==i.confirm_time&&i.confirm_time===e&&(t+="loc-app-sc-services__time--confirm"),t}}}),Vue.component("local-appointmentsshortcode-services-choose-details",{props:["options","service","preview","day","time","fields"],template:"#local-appointmentstemplate__component__shortcode-services-choose-details",data:function(){var e=this;return{loading:!1,edit_field:{},edit_field_id:0,dialog_edit_field:!1}},methods:{openDay:function(e){this.$emit("service-selected",e)},editField:function(e,i){console.log(e,i);var t=this;t.edit_field=JSON.parse(JSON.stringify(e)),t.edit_field_id=parseInt(i),t.dialog_edit_field=!0},saveField:function(){var e=this,i=JSON.parse(JSON.stringify(e.fields));i[e.edit_field_id]=JSON.parse(JSON.stringify(e.edit_field)),e.$emit("fields-updated",i),e.dialog_edit_field=!1},addOption:function(){var e=this;e.edit_field.options.push("Option "+(e.edit_field.options.length+1).toString())},removeOption:function(e){this.edit_field.options.splice(e,1)}}});var app_wp_apps=[];Array.prototype.forEach.call(document.querySelectorAll("div.app"),function(e,i){var t=e.getAttribute("id").replace("local-appointments-","");app_wp_apps[i]=new Vue({el:"#local-appointments-"+t,mounted:function(){},data:function(){return{form:{show_duration:!1,show_price:!1,days_limit:14,time_increments:15,show_noon:!0}}}})});