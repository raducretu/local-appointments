Vue.component("local-appointmentsshortcode-services",{props:["options"],template:"#local-appointmentstemplate__component__shortcode-services",data:function(){var e=this;return{services:[],loading:!1,choose_service:!0,choose_day:!1,choose_time:!1,choose_details:!1,first_day:parseInt(window.local_appointments_locale.first_day),today:moment().format("YYYY-MM-DD"),calendar_day:"",form:{service:{},day:"",time:0},limit:e.options.days_limit,filter_day:-1,filter_time_starting:0,filter_time_ending:1440,confirm_time:!1,form_questions:[{type:"text",label:"Full Name",mandatory:!0,allow_mandatory:!1,allow_delete:!1,status:!0,placeholder:"Enter Full Name Here",value:""},{type:"email",label:"Email Address",mandatory:!0,allow_mandatory:!1,allow_delete:!1,status:!0,placeholder:"Enter Email Here",value:""}],edit_field:{},edit_field_id:null,dialog_edit_field:!1}},watch:{options:{handler:function(e){this.limit=e.days_limit},deep:!0}},mounted:function(){var e=this;0===e.services.length&&e.getServices()},computed:{services_min_time:function(){var e=this,i=1441;return _.isUndefined(e.form.service.availability.days)||_.each(e.form.service.availability.days,function(e){_.each(e,function(e){i=e[0]<i?e[0]:i})}),i},services_max_time:function(){var e=this,i=-1;return _.isUndefined(e.form.service.availability.days)||_.each(e.form.service.availability.days,function(e){_.each(e,function(e){i=e[1]<i?i:e[1]})}),i},filter_starting_times:function(){for(var e=this,i=[],t=e.services_min_time,a=e.services_max_time,o=t;o<=a;o++)o%60==0&&i.push(o);return i},filter_ending_times:function(){for(var e=this,i=[],t=e.services_min_time+e.form.service.duration,a=e.services_max_time,o=t;o<=a;o++)o%60==0&&i.push(o);return i},week:function(){for(var e=this,i=[],t=e.first_day;t<e.first_day+7;t++){var a=t<=6?t:Math.abs(t-7);i.push(a)}return i},times:function(){var e=this,i=[],t=_.isUndefined(e.form.service.availability.days[moment(e.form.day).isoWeekday().toString()])?[]:e.form.service.availability.days[moment(e.form.day).isoWeekday().toString()];return _.each(t,function(t){for(var a=t[0];a<t[1]-e.form.service.duration;a++)a%e.options.time_increments==0&&i.push(a)}),i},days:function(){for(var e=this,i=[],t=e.limit<e.options.days_limit?e.options.days_limit:e.limit,a=e.normalize(e.form.service),o=0;i.length<t&&o<=100;){var n=!0,s=e.today,r=moment(s).add(o,"days"),l=moment(s).add(o,"days").isoWeekday().toString();-1!==e.filter_day&&parseInt(e.filter_day)!==parseInt(l)&&(n=!1),n&&!_.isUndefined(a.availability.empty)&&a.availability.empty.indexOf(r.format("YYYY_MM_DD"))>=0&&(n=!1),!n||_.isUndefined(a.availability.days)||_.isUndefined(a.availability.days[l])?n=!1:_.each(a.availability.days[l],function(i){var t=i[0]<e.filter_time_starting?i[0]:e.filter_time_starting,a=i[1]>e.filter_time_ending?i[1]:e.filter_time_ending;n=!(a-t>i[1]-i[0]+e.filter_time_ending-e.filter_time_starting)}),n&&i.push({date:r.format("YYYY-MM-DD"),today:r.isSame(e.today,"day"),unavaiable:Math.random()>=.5}),o++}return _.sortBy(i,["date"])}},methods:{addField:function(e){var i=this,t={mandatory:!1,allow_mandatory:!0,allow_delete:!0,status:!0,label:"",type:e,value:""};switch(e){case"text":t.label="New Single Line Text Field",t.placeholder="Enter Text here";break;case"textblock":t.label="New Text Block Field",t.content="Please add some text here.";break;case"date":t.label="New Date Field",t.placeholder="Enter Text here";break;case"textarea":t.label="New Multiline Text Field",t.placeholder="Enter Text here";break;case"checkbox":t.label="New Checkbox Field",t.options="Check me",t.default=!1;break;case"checkboxes":t.label="New Checkboxes List Field",t.options=["Option 1","Option 2","Option 3"],t.value=[];break;case"radio":t.label="New Radio List Field",t.options=["Option 1","Option 2","Option 3"];break;case"multiselect":t.label="New Multi Select Field",t.options=["Option 1","Option 2","Option 3"],t.placeholder="Choose Options",t.value=[];break;case"select":t.label="New Select Field",t.options=["Option 1","Option 2","Option 3"],t.placeholder="Choose option";break}i.form_questions.push(t)},editField:function(e,i){var t=this;t.edit_field=t.normalize(e),t.edit_field_id=parseInt(i),t.dialog_edit_field=!0},removeField:function(){var e=this;!_.isUndefined(e.form_questions[e.edit_field_id])&&e.form_questions[e.edit_field_id].allow_delete&&(e.form_questions.splice(e.edit_field_id,1),e.dialog_edit_field=!1)},saveField:function(){var e=this;e.form_questions[e.edit_field_id]=e.normalize(e.edit_field),e.dialog_edit_field=!1},addOption:function(){var e=this;e.edit_field.options.push("Option "+(e.edit_field.options.length+1).toString())},removeOption:function(e){this.edit_field.options.splice(e,1)},parseMarkdown:function(e){return marked(e,{sanitize:!0})},clearConfirmation:function(e){this.confirm_time=!1},confirmTime:function(e,i){var t=this;t.confirm_time=e,i&&(t.form.time=e,t.choose_time=!1,t.choose_details=!0)},getTimeClasses:function(e){var i=this,t="";return!1!==i.confirm_time&&i.confirm_time!==e?t+="local-appointmentsshortcode-services__time--not-confirm":!1!==i.confirm_time&&i.confirm_time===e&&(t+="local-appointmentsshortcode-services__time--confirm"),t},isDayDisabled:function(e){var i=this,t=i.normalize(i.form.service);return!(!_.isUndefined(t.availability.days[e])&&!_.isEmpty(t.availability.days[e]))},getDayName:function(e){return window.local_appointments_locale.day_names_short[e]},openTime:function(e){var i=this;i.form.day=e.date,i.choose_time=!0,i.choose_day=!1},backToServices:function(){var e=this;e.choose_service=!0,e.choose_day=!1,e.form.service={}},backToDays:function(){var e=this;e.choose_service=!1,e.choose_day=!0,e.choose_time=!1,e.form.day=""},showMore:function(){this.limit+=this.options.days_limit},isSamePeriod:function(e,i){var t=this;return!_.isUndefined(t.times[i-1])&&(e/60>12&&t.times[i-1]/60<=12)},isSameMonth:function(e,i){var t=this;return!_.isUndefined(t.days[i-1])&&!_.isUndefined(t.days[i-1].date)&&!moment(e.date).isSame(moment(t.days[i-1].date),"month")},getDayClasses:function(e){var i=this,t="";return e.unavaiable&&(t+="local-appointmentsshortcode-services__day--unavailable "),e.today&&(t+="local-appointmentsshortcode-services__day--today "),t},getDayColor:function(e){var i=this;return e.today?"red":e.unavailable?"gray":"#208D52"},openDay:function(e){var i=this;i.choose_service=!1,i.choose_day=!0,i.form.service=e,i.filter_time_starting=60*parseInt(i.services_min_time/60),i.filter_time_ending=60*parseInt(i.services_max_time/60)},getServices:function(){var e=this;e.loading=!0,e.$http.get(window.local_appointments_locale.rest_api_base.services+"?status=any&per_page=100",{emulateJSON:!0,headers:{"X-WP-Nonce":window.local_appointments_locale.rest_nonce}}).then(function(i){console.log(i),e.services=_.map(i.body,e.normalizeService),e.loading=!1},function(i){console.log(i),e.loading=!1})}}});